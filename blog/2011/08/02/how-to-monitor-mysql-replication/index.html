
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>How to monitor MySQL Replication - reg88.com</title>
  <meta name="author" content="Mike Moghadas">

  
  <meta name="description" content="I have spent some time looking for a solution to monitor MySQL Replication with no lock. So I decided to figure something out myself rather than &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mmoghadas.github.io/blog/2011/08/02/how-to-monitor-mysql-replication/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="reg88.com" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">mike.moghadas</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">reg88.com</a></h1>
  
    <h2>fine...I&#039;ll blog too</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mmoghadas.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">How to Monitor MySQL Replication</h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2011-08-02T00:00:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I have spent some time looking for a solution to monitor MySQL Replication with no lock. So I decided to figure something out myself rather than wasting more time or end up paying Oracle. Turns out the setup is actually very simple and can be easily setup with few lines of shell script and a monitoring tool that can produce alerts and graphs via SNMP Traps (PRTG in my case).</p>

<p><strong>What do you need?</strong><br/>
<em>Note: Make sure to update the below addresses</em><br/>
MySQL Master: 192.168.1.101<br/>
MySQL Slave: 192.168.1.102<br/>
SNMP Tools (snmptrap specifically)<br/>
Monitoring Server (I use PRTG): 192.168.1.116<br/>
Your shell script<br/>
A Replication client user must be created on both Master and Slave servers.</p>

<!--more-->


<p><strong>Where do you configure things?</strong><br/>
You can run the script/cronjob from either Master or the Slave. I configured the job on the Slave server keep the load off the Master.</p>

<p><strong>Step1:</strong> Configure Replication. I’m not going to cover replication here. Plenty of articles available on how to configure replication</p>

<p><strong>Step2:</strong> Create the Replication Client user on Master and Slave. Run the following command on both servers. Make sure to grant REPLICATION CLIENT privilege only.</p>

<p><em>Note: replace the “*<strong>*</strong>*</em><em>**” with your password for the new account.</em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">GRANT</span> <span class="n">REPLICATION</span> <span class="n">CLIENT</span> <span class="n">ON</span> <span class="err">\</span><span class="o">*</span><span class="p">.</span><span class="err">\</span><span class="o">*</span> <span class="n">TO</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8216</span><span class="p">;</span><span class="n">rep</span><span class="o">-</span><span class="n">client</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8217</span><span class="p">;@</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8217</span><span class="p">;</span><span class="mf">192.168.1.101</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8242</span><span class="p">;</span> <span class="n">IDENTIFIED</span> <span class="n">BY</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8216</span><span class="p">;</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">*****&amp;</span><span class="err">#</span><span class="mi">8217</span><span class="p">;;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Step3:</strong> Test your newly created account’s permissions. Logon to the Slave server and run the following commands Master and the Slave:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">mysql</span> <span class="o">-</span><span class="n">urep</span><span class="o">-</span><span class="n">client</span> <span class="o">-</span><span class="n">p</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">*****</span> <span class="o">-</span><span class="n">h192</span><span class="mf">.168.1.101</span> <span class="o">-</span><span class="n">e</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">show</span> <span class="n">master</span> <span class="n">statusG</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="n">mysql</span> <span class="o">-</span><span class="n">urep</span><span class="o">-</span><span class="n">client</span> <span class="o">-</span><span class="n">p</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">*****</span> <span class="o">-</span><span class="n">h192</span><span class="mf">.168.1.102</span> <span class="o">-</span><span class="n">e</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">show</span> <span class="n">slave</span> <span class="n">statusG</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Step4:</strong> Create the following script</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">vi</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">MySQL</span><span class="err">\</span><span class="n">_Replication</span><span class="err">\</span><span class="n">_Check</span>
</span><span class='line'><span class="cp">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#MASTER Variables  </span>
</span><span class='line'><span class="n">M_Position</span><span class="o">=</span><span class="err">\`</span><span class="n">mysql</span> <span class="o">-</span><span class="n">urep</span><span class="o">-</span><span class="n">client</span> <span class="o">-</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">****</span><span class="err">\</span><span class="o">*</span> <span class="o">-</span><span class="n">h192</span><span class="mf">.168.1.101</span> <span class="o">-</span><span class="n">e</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">show</span> <span class="n">master</span> <span class="n">statusG</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">Position</span> <span class="o">|</span> <span class="n">sed</span> <span class="o">-</span><span class="n">e</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8216</span><span class="p">;</span><span class="n">s</span><span class="o">/</span><span class="p">[</span><span class="o">^:</span><span class="p">]</span><span class="err">\</span><span class="o">*:</span><span class="c1">//&amp;#8217;\`  </span>
</span><span class='line'><span class="n">M_File</span><span class="o">=</span><span class="err">\`</span><span class="n">mysql</span> <span class="o">-</span><span class="n">urep</span><span class="o">-</span><span class="n">client</span> <span class="o">-</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">****</span><span class="err">\</span><span class="o">*</span> <span class="o">-</span><span class="n">h192</span><span class="mf">.168.1.101</span> <span class="o">-</span><span class="n">e</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">show</span> <span class="n">master</span> <span class="n">statusG</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">File</span> <span class="o">|</span> <span class="n">sed</span> <span class="o">-</span><span class="n">e</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8216</span><span class="p">;</span><span class="n">s</span><span class="o">/</span><span class="p">[</span><span class="o">^:</span><span class="p">]</span><span class="err">\</span><span class="o">*:</span><span class="c1">//&amp;#8217;\`</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#SLAVE Variables  </span>
</span><span class='line'><span class="n">S</span><span class="err">\</span><span class="n">_Exec</span><span class="err">\</span><span class="n">_Master</span><span class="err">\</span><span class="n">_Log</span><span class="err">\</span><span class="n">_Pos</span><span class="o">=</span><span class="err">\`</span><span class="n">mysql</span> <span class="o">-</span><span class="n">urep</span><span class="o">-</span><span class="n">client</span> <span class="o">-</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">****</span><span class="err">\</span><span class="o">*</span> <span class="o">-</span><span class="n">h192</span><span class="mf">.168.1.102</span> <span class="o">-</span><span class="n">e</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">show</span> <span class="n">slave</span> <span class="n">statusG</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">Exec</span><span class="err">\</span><span class="n">_Master</span><span class="err">\</span><span class="n">_Log_Pos</span> <span class="o">|</span> <span class="n">sed</span> <span class="o">-</span><span class="n">e</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8216</span><span class="p">;</span><span class="n">s</span><span class="o">/</span><span class="p">[</span><span class="o">^:</span><span class="p">]</span><span class="err">\</span><span class="o">*:</span><span class="c1">//&amp;#8217;\`  </span>
</span><span class='line'><span class="n">S</span><span class="err">\</span><span class="n">_Master</span><span class="err">\</span><span class="n">_Log</span><span class="err">\</span><span class="n">_File</span><span class="o">=</span><span class="err">\`</span><span class="n">mysql</span> <span class="o">-</span><span class="n">urep</span><span class="o">-</span><span class="n">client</span> <span class="o">-</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">****</span><span class="err">\</span><span class="o">*</span> <span class="o">-</span><span class="n">h192</span><span class="mf">.168.1.102</span> <span class="o">-</span><span class="n">e</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">show</span> <span class="n">slave</span> <span class="n">statusG</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">Master</span><span class="err">\</span><span class="n">_Log</span><span class="err">\</span><span class="n">_File</span> <span class="o">|</span> <span class="n">sed</span> <span class="o">-</span><span class="n">e</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8216</span><span class="p">;</span><span class="o">/</span><span class="n">Relay</span><span class="err">\</span><span class="n">_Master</span><span class="err">\</span><span class="n">_Log</span><span class="err">\</span><span class="n">_File</span><span class="o">/</span><span class="n">d</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8217</span><span class="p">;</span> <span class="o">|</span> <span class="n">sed</span> <span class="o">-</span><span class="n">e</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8216</span><span class="p">;</span><span class="n">s</span><span class="o">/</span><span class="p">[</span><span class="o">^:</span><span class="p">]</span><span class="err">\</span><span class="o">*:</span><span class="c1">//&amp;#8217;\`  </span>
</span><span class='line'><span class="n">S</span><span class="err">\</span><span class="n">_Slave</span><span class="err">\</span><span class="n">_IO</span><span class="err">\</span><span class="n">_State</span><span class="o">=</span><span class="err">\`</span><span class="n">mysql</span> <span class="o">-</span><span class="n">urep</span><span class="o">-</span><span class="n">client</span> <span class="o">-</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">****</span><span class="err">\</span><span class="o">*</span> <span class="o">-</span><span class="n">h192</span><span class="mf">.168.1.102</span> <span class="o">-</span><span class="n">e</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">show</span> <span class="n">slave</span> <span class="n">statusG</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">Slave</span><span class="err">\</span><span class="n">_IO_State</span> <span class="o">|</span> <span class="n">sed</span> <span class="o">-</span><span class="n">e</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8216</span><span class="p">;</span><span class="n">s</span><span class="o">/</span><span class="p">[</span><span class="o">^:</span><span class="p">]</span><span class="err">\</span><span class="o">*:</span><span class="c1">//&amp;#8217;\`  </span>
</span><span class='line'><span class="n">S</span><span class="err">\</span><span class="n">_Seconds</span><span class="err">\</span><span class="n">_Behind</span><span class="err">\</span><span class="n">_Master</span><span class="o">=</span><span class="err">\`</span><span class="n">mysql</span> <span class="o">-</span><span class="n">urep</span><span class="o">-</span><span class="n">client</span> <span class="o">-</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">***</span><span class="err">\</span><span class="o">****</span><span class="err">\</span><span class="o">*</span> <span class="o">-</span><span class="n">h192</span><span class="mf">.168.1.102</span> <span class="o">-</span><span class="n">e</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">show</span> <span class="n">slave</span> <span class="n">statusG</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">Seconds</span><span class="err">\</span><span class="n">_Behind_Master</span> <span class="o">|</span> <span class="n">sed</span> <span class="o">-</span><span class="n">e</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8216</span><span class="p">;</span><span class="n">s</span><span class="o">/</span><span class="p">[</span><span class="o">^:</span><span class="p">]</span><span class="err">\</span><span class="o">*:</span><span class="c1">//&amp;#8217;\`  </span>
</span><span class='line'><span class="n">S</span><span class="err">\</span><span class="n">_Slave</span><span class="err">\</span><span class="n">_IO</span><span class="err">\</span><span class="n">_StateString</span><span class="o">=</span><span class="err">\`</span><span class="n">echo</span> <span class="err">$</span><span class="n">S</span><span class="err">\</span><span class="n">_Slave</span><span class="err">\</span><span class="n">_IO</span><span class="err">\</span><span class="n">_State</span><span class="err">\`</span>
</span><span class='line'><span class="n">S</span><span class="err">\</span><span class="n">_Slave</span><span class="err">\</span><span class="n">_IO_StateOK</span><span class="o">=&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span><span class="n">Waiting</span> <span class="k">for</span> <span class="n">master</span> <span class="n">to</span> <span class="n">send</span> <span class="n">event</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#Replication Overall Status. Send SNMPTrap to Monitoring  </span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="p">[</span> <span class="s">&quot;$S\_Slave\_IO\_StateString&quot;</span> <span class="o">==</span> <span class="s">&quot;$S\_Slave\_IO\_StateOK&quot;</span> <span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">[</span> <span class="err">$</span><span class="n">M</span><span class="err">\</span><span class="n">_Position</span> <span class="o">-</span><span class="n">eq</span> <span class="err">$</span><span class="n">S</span><span class="err">\</span><span class="n">_Exec</span><span class="err">\</span><span class="n">_Master</span><span class="err">\</span><span class="n">_Log</span><span class="err">\</span><span class="n">_Pos</span> <span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">[</span> <span class="err">$</span><span class="n">M</span><span class="err">\</span><span class="n">_File</span> <span class="o">==</span> <span class="err">$</span><span class="n">S</span><span class="err">\</span><span class="n">_Master</span><span class="err">\</span><span class="n">_Log</span><span class="err">\</span><span class="n">_File</span> <span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">[</span> <span class="err">$</span><span class="n">S</span><span class="err">\</span><span class="n">_Seconds</span><span class="err">\</span><span class="n">_Behind</span><span class="err">\</span><span class="n">_Master</span> <span class="o">-</span><span class="n">lt</span> <span class="mi">5</span> <span class="p">]</span>
</span><span class='line'><span class="n">then</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Replication</span> <span class="n">is</span> <span class="n">running</span> <span class="n">fine</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8230</span><span class="p">;.</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="n">snmptrap</span> <span class="o">-</span><span class="n">v</span> <span class="mi">1</span> <span class="o">-</span><span class="n">c</span> <span class="n">ROpublic</span> <span class="mf">192.168.1.99</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="mf">1.11.12.13.14.15111</span> <span class="n">s</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Replication</span> <span class="n">OK</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Replication</span> <span class="n">BROKEN</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="n">snmptrap</span> <span class="o">-</span><span class="n">v</span> <span class="mi">1</span> <span class="o">-</span><span class="n">c</span> <span class="n">ROpublic</span> <span class="mf">192.168.1.99</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="mf">1.11.12.13.14.15111</span> <span class="n">s</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Replication</span> <span class="n">Broken</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="n">fi</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#Replication State Status  </span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Slave</span> <span class="n">IO</span> <span class="n">State</span><span class="o">:</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="err">$</span><span class="n">S</span><span class="err">\</span><span class="n">_Slave</span><span class="err">\</span><span class="n">_IO_StateString</span>
</span><span class='line'><span class="k">if</span> <span class="p">[</span> <span class="s">&quot;$S\_Slave\_IO\_StateString&quot;</span> <span class="o">==</span> <span class="s">&quot;$S\_Slave\_IO\_StateOK&quot;</span> <span class="p">]</span>
</span><span class='line'><span class="n">then</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Replication</span> <span class="n">OK</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Replication</span> <span class="n">STOPPED</span><span class="o">!&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="n">fi</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#Replication Log Files Status  </span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Master</span> <span class="n">Log</span> <span class="n">File</span><span class="o">:</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="err">$</span><span class="n">M_File</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Slave</span> <span class="n">Log</span> <span class="n">File</span><span class="o">:</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="err">$</span><span class="n">S</span><span class="err">\</span><span class="n">_Master</span><span class="err">\</span><span class="n">_Log_File</span>
</span><span class='line'><span class="k">if</span> <span class="p">[</span> <span class="err">$</span><span class="n">M</span><span class="err">\</span><span class="n">_File</span> <span class="o">==</span> <span class="err">$</span><span class="n">S</span><span class="err">\</span><span class="n">_Master</span><span class="err">\</span><span class="n">_Log</span><span class="err">\</span><span class="n">_File</span> <span class="p">]</span>
</span><span class='line'><span class="n">then</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Log</span> <span class="n">Files</span><span class="o">:</span> <span class="n">OK</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Log</span> <span class="n">Files</span> <span class="n">DO</span> <span class="n">NOT</span> <span class="n">Match</span><span class="o">!&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="n">fi</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#Replication Log Position Status  </span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Master</span> <span class="n">Position</span><span class="o">:</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="err">$</span><span class="n">M_Position</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Slave</span> <span class="n">Position</span><span class="o">:</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="err">$</span><span class="n">S</span><span class="err">\</span><span class="n">_Exec</span><span class="err">\</span><span class="n">_Master</span><span class="err">\</span><span class="n">_Log</span><span class="err">\</span><span class="n">_Pos</span>
</span><span class='line'><span class="k">if</span> <span class="p">[</span> <span class="err">$</span><span class="n">M</span><span class="err">\</span><span class="n">_Position</span> <span class="o">-</span><span class="n">eq</span> <span class="err">$</span><span class="n">S</span><span class="err">\</span><span class="n">_Exec</span><span class="err">\</span><span class="n">_Master</span><span class="err">\</span><span class="n">_Log_Pos</span> <span class="p">]</span>
</span><span class='line'><span class="n">then</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Position</span><span class="o">:</span> <span class="n">OK</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Slave</span> <span class="n">is</span> <span class="n">Behind</span><span class="o">!&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="n">fi</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#Slave Seconds Behind Master  </span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Slave</span> <span class="n">Seconds</span> <span class="n">Behind</span> <span class="n">Master</span><span class="o">:</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span> <span class="err">$</span><span class="n">S</span><span class="err">\</span><span class="n">_Seconds</span><span class="err">\</span><span class="n">_Behind_Master</span>
</span><span class='line'><span class="k">if</span> <span class="p">[</span> <span class="err">$</span><span class="n">S</span><span class="err">\</span><span class="n">_Seconds</span><span class="err">\</span><span class="n">_Behind_Master</span> <span class="o">-</span><span class="n">lt</span> <span class="mi">5</span> <span class="p">]</span>
</span><span class='line'><span class="n">then</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Acceptable</span><span class="o">:</span> <span class="nb">YES</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="n">echo</span> <span class="o">&amp;</span><span class="err">#</span><span class="mi">8220</span><span class="p">;</span><span class="n">Acceptable</span><span class="o">:</span> <span class="nb">NO</span><span class="p">,</span> <span class="n">Slave</span> <span class="n">is</span> <span class="n">Way</span> <span class="n">Behind</span><span class="o">!&amp;</span><span class="err">#</span><span class="mi">8221</span><span class="p">;</span>
</span><span class='line'><span class="n">fi</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Step5:</strong> Create a cronjob to run your new script every 60 seconds. You can adjust this if you like.. All depends on how busy your database is.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">crontab</span> <span class="o">-</span><span class="n">e</span>
</span><span class='line'><span class="err">\#</span> <span class="n">MySQL</span> <span class="n">Replication</span> <span class="n">Check</span>
</span><span class='line'><span class="err">\</span><span class="o">*</span> <span class="err">\</span><span class="o">*</span> <span class="err">\</span><span class="o">*</span> <span class="err">\</span><span class="o">*</span> <span class="o">*</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">MySQL</span><span class="err">\</span><span class="n">_Replication</span><span class="err">\</span><span class="n">_Check</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Step6:</strong> Configure your monitoring to receive SNMPTraps from your slave (or where you are running your cronjob). The following is meant to be used with PRTG. You can configure other monitoring tools to received SNMP Traps as well.<br/>
&ndash; Logon to the Web Interface<br/>
&ndash; Devices<br/>
&ndash; Select your Probe<br/>
&ndash; Add Sensor<br/>
&ndash; Select or search for &#8220;SNMP Trap Receiver&#8221; and complete the following:<br/>
OID value: 1.11.12.13.14.15111<br/>
Sender: 192.168.1.102<br/>
Set sensor to &#8216;warning&#8217;/Message must include: Replication OK<br/>
Set sensor to &#8216;warning&#8217;/Message must not include: Replication Broken<br/>
Scanning Interval: 60 seconds</p>

<p><strong>Step7:</strong> Make sure you have SNMP Tools installed.<br/>
On Redhat:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">yum</span> <span class="n">install</span> <span class="n">net</span><span class="o">-</span><span class="n">snmp</span><span class="o">-</span><span class="n">utils</span>
</span></code></pre></td></tr></table></div></figure>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Mike Moghadas</span></span>

      








  


<time datetime="2011-08-02T00:00:00-07:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/mysql/'>mysql</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://mmoghadas.github.io/blog/2011/08/02/how-to-monitor-mysql-replication/" data-via="" data-counturl="http://mmoghadas.github.io/blog/2011/08/02/how-to-monitor-mysql-replication/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left articlenav" href="/blog/2011/07/19/how-to-get-pl2303-usb-to-serial-driver-to-work-on-mac-os-x-10-7-64bit/" title="Previous Post: How to get PL2303 USB to Serial Driver to work on Mac OS X 10.7 (64bit)">&laquo; How to get PL2303 USB to Serial Driver to work on Mac OS X 10.7 (64bit)</a>
      
      
        <a class="basic-alignment right articlenav" href="/blog/2011/11/18/keep-iis-logs-clean-and-keep-only-a-week-worth-of-logs/" title="Next Post: Keep IIS Logs Clean and keep only a week worth of logs">Keep IIS Logs Clean and keep only a week worth of logs &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/03/01/installing-and-configuring-puppetmaster-and-puppet-clients-on-ubuntu/">Installing and Configuring Puppetmaster and Puppet Clients (on Ubuntu)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/22/how-to-install-homebrew-on-osx-lion/">How to Install Homebrew on OSX Lion</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/01/remote-logging-server-syslog-rsyslog/">Remote Logging Server: Syslog | Rsyslog</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/01/note-to-self-dont-use-scripts-on-blogger/">Note to Self: Don&#8217;t Use Scripts on Blogger!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/01/347/">How to Configure and Install WordPress on Nginx + PHP-FPM</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Mike Moghadas -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
